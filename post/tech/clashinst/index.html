<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>在openWrt上安装并配置Clash (Clash篇) | 瞬间</title><meta name=keywords content="openWrt,clash,2023"><meta name=description content="安装并配置Clash"><meta name=author content><link rel=canonical href=https://qing.shuncs.com/post/tech/clashinst/><link rel=stylesheet href=https://ik.imagekit.io/chinesefonts/packages/lxgwwenkai/dist/LXGWWenKai-Regular/result.css><link crossorigin=anonymous href=/assets/css/stylesheet.152cfb3835eb317a48a417059967d81277f556747c4b89dc1bb0ae5a15043468.css integrity="sha256-FSz7ODXrMXpIpBcFmWfYEnf1VnR8S4ncG7CuWhUENGg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://qing.shuncs.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://qing.shuncs.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://qing.shuncs.com/favicon-32x32.png><link rel=apple-touch-icon href=https://qing.shuncs.com/apple-touch-icon.png><link rel=mask-icon href=https://qing.shuncs.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="在openWrt上安装并配置Clash (Clash篇)"><meta property="og:description" content="安装并配置Clash"><meta property="og:type" content="article"><meta property="og:url" content="https://qing.shuncs.com/post/tech/clashinst/"><meta property="og:image" content="https://qing.shuncs.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-01-19T15:28:05+08:00"><meta property="article:modified_time" content="2023-01-19T15:28:05+08:00"><meta property="og:site_name" content="Moment"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://qing.shuncs.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="在openWrt上安装并配置Clash (Clash篇)"><meta name=twitter:description content="安装并配置Clash"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://qing.shuncs.com/post/"},{"@type":"ListItem","position":2,"name":"在openWrt上安装并配置Clash (Clash篇)","item":"https://qing.shuncs.com/post/tech/clashinst/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在openWrt上安装并配置Clash (Clash篇)","name":"在openWrt上安装并配置Clash (Clash篇)","description":"安装并配置Clash","keywords":["openWrt","clash","2023"],"articleBody":"安装环境 软路由机器架构: x86_64\nOpenWrt版本: 22.03\nClash版本: Premium\nOpenWrt的IP: 192.168.88.3 (如果不同,后面涉及此地址全部需要修改)\n目标 安装及配置完Clash后，在浏览器的设置-\u003e系统-\u003e打开您计算机的代理设置-\u003e手动设置代理 按上图输入主路由器地址和端口，并保存退出就可以访问Google\n0. 下载 以下软件需要预先下载，然后再通过Winscp工具上传到openWrt里面。\nClash Country.mmdb yacd (UI界面，可选) 也可以在openWrt命令行执行以下脚本自动安装及配置后续全部内容（但代理配置文件仍需自定义）\nwget https://www.shuncs.com/download/instclash.sh \u0026\u0026 chmod +x instclash.sh \u0026\u0026 ./instclash.sh 1. 安装Clash 打开Winscp客户端，点击新建会话(快捷键ctrl+n)，文件协议选择SCP，主机名里面输入主路由器地址192.168.88.3，用户名输入root，如下图 然后点击保存和确定，然后点击登录，将下载好的软件上传到openWrt中(如果有密钥提示，点击添加)\n使用putty登录openWrt，然后按顺序执行以下命令（大小写勿输错）\ncd /root gunzip clash-linux-amd64-latest.gz mv clash-linux-amd64-latest /usr/bin/clash chmod +x /usr/bin/clash mkdir -p /root/.config/clash mv Country.mmdb .config/clash/ 2. 配置 新增Clash配置文件 vi /root/.config/clash/router.yaml 将如下内容复制到文件中(以下部分内容自定义)，然后输入:wq保存退出\nmixed-port: 7890 redir-port: 7892 tproxy-port: 7893 allow-lan: true log-level: info ipv6: false #下面三行内容可以在web页面查看流量规则等,如果未安装请在前面加# secret: '' external-controller: '192.168.88.3:9090' external-ui: ui profile: store-fake-ip: true #如果未安装tun，请在前面加#注释掉 tun: enable: true stack: system dns-hijack: - tcp://8.8.8.8:53 - udp://8.8.8.8:53 auto-route: true auto-detect-interface: true dns: enable: true ipv6: false listen: 0.0.0.0:5353 enhanced-mode: fake-ip fake-ip-range: 198.18.0.1/16 nameserver: - 114.114.114.114 - 223.5.5.5 fallback: - tls://dns.google:853 - tls://1.1.1.1:853 fallback-filter: geoip: true ipcidr: - 240.0.0.0/4 proxy-providers: proxyA: #根据实际情况自定义 type: file path: ./proxies/proxyA.yaml #根据实际情况自定义 health-check: enable: true interval: 36000 url: http://www.gstatic.com/generate_204 proxyB: #根据实际情况自定义 type: file path: ./proxies/proxyB.yaml #根据实际情况自定义 health-check: enable: true interval: 36000 url: http://www.gstatic.com/generate_204 proxyURL: #如果是订阅链接在此处配置即可 type: url url: \"https://raw.githubusercontent.com/learnhard-cn/free_proxy_ss/main/clash/clash.provider.yaml\" #根据实际情况自定义 interval: 3600 path: ./proxies/proxyURL.yaml #根据实际情况自定义 health-check: enable: true interval: 600 url: http://www.gstatic.com/generate_204 proxy-groups: - name: \"auto\" type: url-test use: - proxyA #需要和上面名称对应 - proxyB #需要和上面名称对应 url: 'http://www.gstatic.com/generate_204' interval: 300 - name: Proxy type: select use: - proxyB #需要和上面名称对应 # fallback 自动选择服务器 - name: \"fallback-auto\" type: fallback use: - proxyA #需要和上面名称对应 - proxyB #需要和上面名称对应 url: 'http://www.gstatic.com/generate_204' interval: 300 - name: \"load-balance\" type: load-balance use: - proxyA #需要和上面名称对应 - proxyB #需要和上面名称对应 url: 'http://www.gstatic.com/generate_204' interval: 300 rule-providers: reject: type: file behavior: classical path: ./rules/reject.yaml proxy: type: file behavior: classical path: ./rules/proxy.yaml rules: # 拒绝-\u003e代理-\u003e其余直连 - RULE-SET,reject,REJECT - RULE-SET,proxy,fallback-auto - MATCH,DIRECT 新增规则文件 输入以下命令\nvi /root/.config/clash/rules/proxy.yaml 将如下内容复制到文件中，然后输入:wq保存退出\npayload: - DOMAIN-KEYWORD,amazon - DOMAIN-KEYWORD,google - DOMAIN-KEYWORD,gmail - DOMAIN-KEYWORD,youtube - DOMAIN-KEYWORD,facebook - DOMAIN-SUFFIX,fb.me - DOMAIN-SUFFIX,fbcdn.net - DOMAIN-KEYWORD,twitter - DOMAIN-KEYWORD,instagram - DOMAIN-KEYWORD,dropbox - DOMAIN-SUFFIX,twimg.com - DOMAIN-KEYWORD,blogspot - DOMAIN-SUFFIX,youtu.be - DOMAIN-KEYWORD,whatsapp - DOMAIN-SUFFIX,9to5mac.com - DOMAIN-SUFFIX,abpchina.org - DOMAIN-SUFFIX,adblockplus.org - DOMAIN-SUFFIX,adobe.com - DOMAIN-SUFFIX,akamaized.net - DOMAIN-SUFFIX,alfredapp.com - DOMAIN-SUFFIX,amplitude.com - DOMAIN-SUFFIX,ampproject.org - DOMAIN-SUFFIX,android.com - DOMAIN-SUFFIX,angularjs.org - DOMAIN-SUFFIX,aolcdn.com - DOMAIN-SUFFIX,apkpure.com - DOMAIN-SUFFIX,appledaily.com - DOMAIN-SUFFIX,appshopper.com - DOMAIN-SUFFIX,appspot.com - DOMAIN-SUFFIX,arcgis.com - DOMAIN-SUFFIX,archive.org - DOMAIN-SUFFIX,armorgames.com - DOMAIN-SUFFIX,aspnetcdn.com - DOMAIN-SUFFIX,att.com - DOMAIN-SUFFIX,awsstatic.com - DOMAIN-SUFFIX,azureedge.net - DOMAIN-SUFFIX,azurewebsites.net - DOMAIN-SUFFIX,bing.com - DOMAIN-SUFFIX,bintray.com - DOMAIN-SUFFIX,bit.com - DOMAIN-SUFFIX,bit.ly - DOMAIN-SUFFIX,bitbucket.org - DOMAIN-SUFFIX,bjango.com - DOMAIN-SUFFIX,bkrtx.com - DOMAIN-SUFFIX,blog.com - DOMAIN-SUFFIX,blogcdn.com - DOMAIN-SUFFIX,blogger.com - DOMAIN-SUFFIX,blogsmithmedia.com - DOMAIN-SUFFIX,blogspot.com - DOMAIN-SUFFIX,blogspot.hk - DOMAIN-SUFFIX,bloomberg.com - DOMAIN-SUFFIX,box.com - DOMAIN-SUFFIX,box.net - DOMAIN-SUFFIX,cachefly.net - DOMAIN-SUFFIX,chromium.org - DOMAIN-SUFFIX,cl.ly - DOMAIN-SUFFIX,cloudflare.com - DOMAIN-SUFFIX,cloudfront.net - DOMAIN-SUFFIX,cloudmagic.com - DOMAIN-SUFFIX,cmail19.com - DOMAIN-SUFFIX,cnet.com - DOMAIN-SUFFIX,cocoapods.org - DOMAIN-SUFFIX,comodoca.com - DOMAIN-SUFFIX,crashlytics.com - DOMAIN-SUFFIX,culturedcode.com - DOMAIN-SUFFIX,d.pr - DOMAIN-SUFFIX,danilo.to - DOMAIN-SUFFIX,dayone.me - DOMAIN-SUFFIX,db.tt - DOMAIN-SUFFIX,deskconnect.com - DOMAIN-SUFFIX,disq.us - DOMAIN-SUFFIX,disqus.com - DOMAIN-SUFFIX,disquscdn.com - DOMAIN-SUFFIX,dnsimple.com - DOMAIN-SUFFIX,docker.com - DOMAIN-SUFFIX,dribbble.com - DOMAIN-SUFFIX,droplr.com - DOMAIN-SUFFIX,duckduckgo.com - DOMAIN-SUFFIX,dueapp.com - DOMAIN-SUFFIX,dytt8.net - DOMAIN-SUFFIX,edgecastcdn.net - DOMAIN-SUFFIX,edgekey.net - DOMAIN-SUFFIX,edgesuite.net - DOMAIN-SUFFIX,engadget.com - DOMAIN-SUFFIX,entrust.net - DOMAIN-SUFFIX,eurekavpt.com - DOMAIN-SUFFIX,evernote.com - DOMAIN-SUFFIX,fabric.io - DOMAIN-SUFFIX,fast.com - DOMAIN-SUFFIX,fastly.net - DOMAIN-SUFFIX,fc2.com - DOMAIN-SUFFIX,feedburner.com - DOMAIN-SUFFIX,feedly.com - DOMAIN-SUFFIX,feedsportal.com - DOMAIN-SUFFIX,fiftythree.com - DOMAIN-SUFFIX,firebaseio.com - DOMAIN-SUFFIX,flexibits.com - DOMAIN-SUFFIX,flickr.com - DOMAIN-SUFFIX,flipboard.com - DOMAIN-SUFFIX,g.co - DOMAIN-SUFFIX,gabia.net - DOMAIN-SUFFIX,geni.us - DOMAIN-SUFFIX,gfx.ms - DOMAIN-SUFFIX,ggpht.com - DOMAIN-SUFFIX,ghostnoteapp.com - DOMAIN-SUFFIX,git.io - DOMAIN-KEYWORD,github - DOMAIN-SUFFIX,globalsign.com - DOMAIN-SUFFIX,gmodules.com - DOMAIN-SUFFIX,godaddy.com - DOMAIN-SUFFIX,golang.org - DOMAIN-SUFFIX,gongm.in - DOMAIN-SUFFIX,goo.gl - DOMAIN-SUFFIX,goodreaders.com - DOMAIN-SUFFIX,goodreads.com - DOMAIN-SUFFIX,gravatar.com - DOMAIN-SUFFIX,gstatic.com - DOMAIN-SUFFIX,gvt0.com - DOMAIN-SUFFIX,hockeyapp.net - DOMAIN-SUFFIX,hotmail.com - DOMAIN-SUFFIX,icons8.com - DOMAIN-SUFFIX,ifixit.com - DOMAIN-SUFFIX,ift.tt - DOMAIN-SUFFIX,ifttt.com - DOMAIN-SUFFIX,iherb.com - DOMAIN-SUFFIX,imageshack.us - DOMAIN-SUFFIX,img.ly - DOMAIN-SUFFIX,imgur.com - DOMAIN-SUFFIX,imore.com - DOMAIN-SUFFIX,instapaper.com - DOMAIN-SUFFIX,ipn.li - DOMAIN-SUFFIX,is.gd - DOMAIN-SUFFIX,issuu.com - DOMAIN-SUFFIX,itgonglun.com - DOMAIN-SUFFIX,itun.es - DOMAIN-SUFFIX,ixquick.com - DOMAIN-SUFFIX,j.mp - DOMAIN-SUFFIX,js.revsci.net - DOMAIN-SUFFIX,jshint.com - DOMAIN-SUFFIX,jtvnw.net - DOMAIN-SUFFIX,justgetflux.com - DOMAIN-SUFFIX,kat.cr - DOMAIN-SUFFIX,klip.me - DOMAIN-SUFFIX,libsyn.com - DOMAIN-SUFFIX,linkedin.com - DOMAIN-SUFFIX,linode.com - DOMAIN-SUFFIX,lithium.com - DOMAIN-SUFFIX,littlehj.com - DOMAIN-SUFFIX,live.com - DOMAIN-SUFFIX,live.net - DOMAIN-SUFFIX,livefilestore.com - DOMAIN-SUFFIX,llnwd.net - DOMAIN-SUFFIX,macid.co - DOMAIN-SUFFIX,macromedia.com - DOMAIN-SUFFIX,macrumors.com - DOMAIN-SUFFIX,mashable.com - DOMAIN-SUFFIX,mathjax.org - DOMAIN-SUFFIX,medium.com - DOMAIN-SUFFIX,mega.co.nz - DOMAIN-SUFFIX,mega.nz - DOMAIN-SUFFIX,megaupload.com - DOMAIN-SUFFIX,microsofttranslator.com - DOMAIN-SUFFIX,mindnode.com - DOMAIN-SUFFIX,mobile01.com - DOMAIN-SUFFIX,modmyi.com - DOMAIN-SUFFIX,msedge.net - DOMAIN-SUFFIX,myfontastic.com - DOMAIN-SUFFIX,name.com - DOMAIN-SUFFIX,nextmedia.com - DOMAIN-SUFFIX,nsstatic.net - DOMAIN-SUFFIX,nssurge.com - DOMAIN-SUFFIX,nyt.com - DOMAIN-SUFFIX,nytimes.com - DOMAIN-SUFFIX,omnigroup.com - DOMAIN-SUFFIX,onedrive.com - DOMAIN-SUFFIX,onenote.com - DOMAIN-SUFFIX,ooyala.com - DOMAIN-SUFFIX,openvpn.net - DOMAIN-SUFFIX,openwrt.org - DOMAIN-SUFFIX,orkut.com - DOMAIN-SUFFIX,osxdaily.com - DOMAIN-SUFFIX,outlook.com - DOMAIN-SUFFIX,ow.ly - DOMAIN-SUFFIX,paddleapi.com - DOMAIN-SUFFIX,parallels.com - DOMAIN-SUFFIX,parse.com - DOMAIN-SUFFIX,pdfexpert.com - DOMAIN-SUFFIX,periscope.tv - DOMAIN-SUFFIX,pinboard.in - DOMAIN-SUFFIX,pinterest.com - DOMAIN-SUFFIX,pixelmator.com - DOMAIN-SUFFIX,pixiv.net - DOMAIN-SUFFIX,playpcesor.com - DOMAIN-SUFFIX,playstation.com - DOMAIN-SUFFIX,playstation.com.hk - DOMAIN-SUFFIX,playstation.net - DOMAIN-SUFFIX,playstationnetwork.com - DOMAIN-SUFFIX,pushwoosh.com - DOMAIN-SUFFIX,rime.im - DOMAIN-SUFFIX,servebom.com - DOMAIN-SUFFIX,sfx.ms - DOMAIN-SUFFIX,shadowsocks.org - DOMAIN-SUFFIX,sharethis.com - DOMAIN-SUFFIX,shazam.com - DOMAIN-SUFFIX,skype.com - DOMAIN-SUFFIX,smartdnsProxy.com - DOMAIN-SUFFIX,smartmailcloud.com - DOMAIN-SUFFIX,sndcdn.com - DOMAIN-SUFFIX,sony.com - DOMAIN-SUFFIX,soundcloud.com - DOMAIN-SUFFIX,sourceforge.net - DOMAIN-SUFFIX,spotify.com - DOMAIN-SUFFIX,squarespace.com - DOMAIN-SUFFIX,sstatic.net - DOMAIN-SUFFIX,st.luluku.pw - DOMAIN-SUFFIX,stackoverflow.com - DOMAIN-SUFFIX,startpage.com - DOMAIN-SUFFIX,staticflickr.com - DOMAIN-SUFFIX,steamcommunity.com - DOMAIN-SUFFIX,symauth.com - DOMAIN-SUFFIX,symcb.com - DOMAIN-SUFFIX,symcd.com - DOMAIN-SUFFIX,tapbots.com - DOMAIN-SUFFIX,tapbots.net - DOMAIN-SUFFIX,tdesktop.com - DOMAIN-SUFFIX,techcrunch.com - DOMAIN-SUFFIX,techsmith.com - DOMAIN-SUFFIX,thepiratebay.org - DOMAIN-SUFFIX,theverge.com - DOMAIN-SUFFIX,time.com - DOMAIN-SUFFIX,timeinc.net - DOMAIN-SUFFIX,tiny.cc - DOMAIN-SUFFIX,tinypic.com - DOMAIN-SUFFIX,tmblr.co - DOMAIN-SUFFIX,todoist.com - DOMAIN-SUFFIX,trello.com - DOMAIN-SUFFIX,trustasiassl.com - DOMAIN-SUFFIX,tumblr.co - DOMAIN-SUFFIX,tumblr.com - DOMAIN-SUFFIX,tweetdeck.com - DOMAIN-SUFFIX,tweetmarker.net - DOMAIN-SUFFIX,twitch.tv - DOMAIN-SUFFIX,txmblr.com - DOMAIN-SUFFIX,typekit.net - DOMAIN-SUFFIX,ubertags.com - DOMAIN-SUFFIX,ublock.org - DOMAIN-SUFFIX,ubnt.com - DOMAIN-SUFFIX,ulyssesapp.com - DOMAIN-SUFFIX,urchin.com - DOMAIN-SUFFIX,usertrust.com - DOMAIN-SUFFIX,v.gd - DOMAIN-SUFFIX,v2ex.com - DOMAIN-SUFFIX,vimeo.com - DOMAIN-SUFFIX,vimeocdn.com - DOMAIN-SUFFIX,vine.co - DOMAIN-SUFFIX,vivaldi.com - DOMAIN-SUFFIX,vox-cdn.com - DOMAIN-SUFFIX,vsco.co - DOMAIN-SUFFIX,vultr.com - DOMAIN-SUFFIX,w.org - DOMAIN-SUFFIX,w3schools.com - DOMAIN-SUFFIX,webtype.com - DOMAIN-SUFFIX,wikiwand.com - DOMAIN-SUFFIX,wikileaks.org - DOMAIN-SUFFIX,wikimedia.org - DOMAIN-SUFFIX,wikipedia.com - DOMAIN-SUFFIX,wikipedia.org - DOMAIN-SUFFIX,windows.com - DOMAIN-SUFFIX,windows.net - DOMAIN-SUFFIX,wire.com - DOMAIN-SUFFIX,wordpress.com - DOMAIN-SUFFIX,workflowy.com - DOMAIN-SUFFIX,wp.com - DOMAIN-SUFFIX,wsj.com - DOMAIN-SUFFIX,wsj.net - DOMAIN-SUFFIX,xda-developers.com - DOMAIN-SUFFIX,xeeno.com - DOMAIN-SUFFIX,xiti.com - DOMAIN-SUFFIX,yahoo.com - DOMAIN-SUFFIX,yimg.com - DOMAIN-SUFFIX,ying.com - DOMAIN-SUFFIX,yoyo.org - DOMAIN-SUFFIX,ytimg.com 新增黑名单文件 输入以下命令\nvi /root/.config/clash/rules/reject.yaml 将如下内容复制到文件中，然后输入:wq保存退出\npayload: - DOMAIN-KEYWORD,admarvel - DOMAIN-KEYWORD,admaster - DOMAIN-KEYWORD,adsage - DOMAIN-KEYWORD,adsmogo - DOMAIN-KEYWORD,adsrvmedia - DOMAIN-KEYWORD,adwords - DOMAIN-KEYWORD,adservice - DOMAIN-SUFFIX,appsflyer.com - DOMAIN-KEYWORD,domob - DOMAIN-SUFFIX,doubleclick.net - DOMAIN-KEYWORD,duomeng - DOMAIN-KEYWORD,dwtrack - DOMAIN-KEYWORD,guanggao - DOMAIN-KEYWORD,lianmeng - DOMAIN-SUFFIX,mmstat.com - DOMAIN-KEYWORD,mopub - DOMAIN-KEYWORD,omgmta - DOMAIN-KEYWORD,openx - DOMAIN-KEYWORD,partnerad - DOMAIN-KEYWORD,pingfore - DOMAIN-KEYWORD,supersonicads - DOMAIN-KEYWORD,uedas - DOMAIN-KEYWORD,umeng - DOMAIN-KEYWORD,usage - DOMAIN-SUFFIX,vungle.com - DOMAIN-KEYWORD,wlmonitor - DOMAIN-KEYWORD,zjtoolbar 测试Clash配置文件的格式是否正确 clash -d /root/.config/clash/ -t -f router.yaml 设置openWrt中每次开机自动启动Clash vi /etc/init.d/clash 将此内容复制到文件中,并输入:wq保存退出。\n#!/bin/sh /etc/rc.common START=90 STOP=15 USE_PROCD=1 #PROCD_DEBUG=1 CONF=/root/.config/clash/ CONFFILE=router.yaml PROG=/usr/bin/clash start_service() { procd_open_instance procd_set_param command $PROG -f $CONF$CONFFILE -d $CONF procd_set_param stdout 1 procd_set_param stderr 1 procd_set_param respawn ${respawn_threshold:-3600} ${respawn_timeout:-5} ${respawn_retry:-9} procd_close_instance } 设置权限，并使之生效 chmod 755 /etc/init.d/clash service clash enable 启动Clash service clash start 配置Clash UI (可选)\n使用Winscp工具，将yacd.tar内的文件夹上传到openWrt机器，然后执行以下命令 mv /root/public /root/.config/clash/ui /etc/init.d/clash restart 在浏览器地址栏中输入: http://192.168.88.3:9090/ui 显示以下内容，在Host一栏输入192.168.88.3，点击确定即可显示Clash详细页面 3. 软件下载 名称 版本号 说明 下载地址 Clash Premium 透明代理 https://release.dreamacro.workers.dev/latest/clash-linux-amd64-latest.gz Clash-dashboard clash Web界面 https://github.com/Dreamacro/clash-dashboard/archive/refs/heads/gh-pages.zip Winscp 5.21 SCP客户端 https://winscp.net/download/WinSCP-5.21.5-Portable.zip Putty 0.78 虚拟终端 https://the.earth.li/~sgtatham/putty/latest/w64/putty.exe Country.mmdb IP地址库 https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb 4. 说明 Clash版本区别 Premium 版本支持TUN和配置文件中RULE-SET\n如果有电视机顶盒,只能使用Premium版本\nClash规则配置文件格式(Premium有效) payload: - DOMAIN-SUFFIX,yinxiang.com - DOMAIN-SUFFIX,fb.me - DOMAIN-KEYWORD,linkedin - DOMAIN,local.adguard.org - IP-CIDR,192.168.0.0/16 - PROCESS-NAME,wechat Clash配置说明\n规则 说明 范例 说明 PROCESS-NAME 匹配进程 wechat.exe 进程名包含该关键字,在透明代理上不生效 PROCESS-SUFFIX 域名后缀 yinxiang.com PROCESS-KEYWORD 域名关键字 linkedin DOMAIN 域名匹配 local.adguard.org IP-CIDR IP段匹配 192.168.0.0/16 SRC-IP-CIDR 源IP段匹配 192.168.0.0/16 GEOIP GEOIP数据库匹配 CN 国家代码 DST-PORT 目标端口匹配 SRC-PORT 源端口匹配 MATCH 全匹配 一般放在最后 Clash的配置文件详细说明\n此配置文件既可以用在普通版本也可以用在Preumium版本\n# HTTP 代理端口 port: 7890 # SOCKS5 代理端口 socks-port: 7891 # Linux 和 macOS 的 redir 透明代理端口 (重定向 TCP 和 TProxy UDP 流量) # redir-port: 7892 # Linux 的透明代理端口（适用于 TProxy TCP 和 TProxy UDP 流量) # tproxy-port: 7893 # HTTP(S) and SOCKS5 共用端口 # mixed-port: 7890 # 本地 SOCKS5/HTTP(S) 服务验证 # authentication: # - \"user1:pass1\" # - \"user2:pass2\" # 允许局域网的连接（可用来共享代理） allow-lan: true bind-address: \"*\" # 此功能仅在 allow-lan 设置为 true 时生效，支持三种参数： # \"*\" 绑定所有的 IP 地址 # 192.168.122.11 绑定一个的 IPv4 地址 # \"[aaaa::a8aa:ff:fe09:57d8]\" 绑定一个 IPv6 地址 # Clash 路由工作模式 # 规则模式：rule（规则） / global（全局代理）/ direct（全局直连） mode: rule # Clash 默认将日志输出至 STDOUT # 设置日志输出级别 (默认级别：silent，即不输出任何内容，以避免因日志内容过大而导致程序内存溢出）。 # 5 个级别：silent / info / warning / error / debug。级别越高日志输出量越大，越倾向于调试，若需要请自行开启。 log-level: silent # clash 的 RESTful API 监听地址 external-controller: 127.0.0.1:9090 # 存放配置文件的相对路径，或存放网页静态资源的绝对路径 # Clash core 将会将其部署在 http://{{external-controller}}/ui # external-ui: folder # RESTful API 的口令 (可选) # 通过 HTTP 头中 Authorization: Bearer ${secret} 参数来验证口令 # 当 RESTful API 的监听地址为 0.0.0.0 时，请务必设定口令以保证安全 # secret: \"\" # 出站网卡接口 # interface-name: en0 # DNS 服务器和建立连接时的 静态 Hosts, 仅在 dns.enhanced-mode 模式为 redir-host 生效 # 支持通配符域名 (例如: *.clash.dev, *.foo.*.example.com ) # 不使用通配符的域名优先级高于使用通配符的域名 (例如: foo.example.com \u003e *.example.com \u003e .example.com ) # 注意: +.foo.com 的效果等同于 .foo.com 和 foo.com hosts: # '*.clash.dev': 127.0.0.1 # '.dev': 127.0.0.1 # 'alpha.clash.dev': '::1' # DNS 服务器配置(可选；若不配置，程序内置的 DNS 服务会被关闭) dns: enable: true listen: 0.0.0.0:53 ipv6: true # 当此选项为 false 时, AAAA 请求将返回空 # 以下填写的 DNS 服务器将会被用来解析 DNS 服务的域名 # 仅填写 DNS 服务器的 IP 地址 default-nameserver: - 223.5.5.5 - 114.114.114.114 enhanced-mode: fake-ip # 或 redir-host fake-ip-range: 198.18.0.1/16 # Fake IP 地址池 (CIDR 形式) # use-hosts: true # 查询 hosts 并返回 IP 记录 # 在以下列表的域名将不会被解析为 fake ip，这些域名相关的解析请求将会返回它们真实的 IP 地址 fake-ip-filter: # 以下域名列表参考自 vernesong/OpenClash 项目，并由 Hackl0us 整理补充 # === LAN === - '*.lan' # === Linksys Wireless Router === - '*.linksys.com' - '*.linksyssmartwifi.com' # === Apple Software Update Service === - 'swscan.apple.com' - 'mesu.apple.com' # === Windows 10 Connnect Detection === - '*.msftconnecttest.com' - '*.msftncsi.com' # === NTP Service === - 'time.*.com' - 'time.*.gov' - 'time.*.edu.cn' - 'time.*.apple.com' - 'time1.*.com' - 'time2.*.com' - 'time3.*.com' - 'time4.*.com' - 'time5.*.com' - 'time6.*.com' - 'time7.*.com' - 'ntp.*.com' - 'ntp.*.com' - 'ntp1.*.com' - 'ntp2.*.com' - 'ntp3.*.com' - 'ntp4.*.com' - 'ntp5.*.com' - 'ntp6.*.com' - 'ntp7.*.com' - '*.time.edu.cn' - '*.ntp.org.cn' - '+.pool.ntp.org' - 'time1.cloud.tencent.com' # === Music Service === ## NetEase - '+.music.163.com' - '*.126.net' ## Baidu - 'musicapi.taihe.com' - 'music.taihe.com' ## Kugou - 'songsearch.kugou.com' - 'trackercdn.kugou.com' ## Kuwo - '*.kuwo.cn' ## JOOX - 'api-jooxtt.sanook.com' - 'api.joox.com' - 'joox.com' ## QQ - '+.y.qq.com' - '+.music.tc.qq.com' - 'aqqmusic.tc.qq.com' - '+.stream.qqmusic.qq.com' ## Xiami - '*.xiami.com' ## Migu - '+.music.migu.cn' # === Game Service === ## Nintendo Switch - '+.srv.nintendo.net' ## Sony PlayStation - '+.stun.playstation.net' ## Microsoft Xbox - 'xbox.*.microsoft.com' - '+.xboxlive.com' # === Other === ## QQ Quick Login - 'localhost.ptlogin2.qq.com' ## Golang - 'proxy.golang.org' ## STUN Server - 'stun.*.*' - 'stun.*.*.*' ## Bilibili CDN - '*.mcdn.bilivideo.cn' # 支持 UDP / TCP / DoT / DoH 协议的 DNS 服务，可以指明具体的连接端口号。 # 所有 DNS 请求将会直接发送到服务器，不经过任何代理。 # Clash 会使用最先获得的解析记录回复 DNS 请求 nameserver: - https://doh.pub/dns-query - https://dns.alidns.com/dns-query # 当 fallback 参数被配置时, DNS 请求将同时发送至上方 nameserver 列表和下方 fallback 列表中配置的所有 DNS 服务器. # 当解析得到的 IP 地址的地理位置不是 CN 时，clash 将会选用 fallback 中 DNS 服务器的解析结果。 # fallback: # - https://dns.google/dns-query # 如果使用 nameserver 列表中的服务器解析的 IP 地址在下方列表中的子网中，则它们被认为是无效的， # Clash 会选用 fallback 列表中配置 DNS 服务器解析得到的结果。 # # 当 fallback-filter.geoip 为 true 且 IP 地址的地理位置为 CN 时， # Clash 会选用 nameserver 列表中配置 DNS 服务器解析得到的结果。 # # 当 fallback-filter.geoip 为 false, 如果解析结果不在 fallback-filter.ipcidr 范围内， # Clash 总会选用 nameserver 列表中配置 DNS 服务器解析得到的结果。 # # 采取以上逻辑进行域名解析是为了对抗 DNS 投毒攻击。 fallback-filter: geoip: false ipcidr: - 240.0.0.0/4 - 0.0.0.0/32 # domain: # - '+.google.com' # - '+.facebook.com' # - '+.youtube.com' proxies: # shadowsocks # 支持加密方式： # aes-128-gcm aes-192-gcm aes-256-gcm # aes-128-cfb aes-192-cfb aes-256-cfb # aes-128-ctr aes-192-ctr aes-256-ctr # rc4-md5 chacha20 chacha20-ietf xchacha20 # chacha20-ietf-poly1305 xchacha20-ietf-poly1305 - name: \"ss1\" type: ss server: server port: 443 cipher: chacha20-ietf-poly1305 password: \"password\" # udp: true - name: \"ss2\" type: ss server: server port: 443 cipher: AEAD_CHACHA20_POLY1305 password: \"password\" plugin: obfs plugin-opts: mode: tls # 混淆模式，可以选择 http 或 tls host: bing.com # 混淆域名，需要和服务器配置保持一致 - name: \"ss3\" type: ss server: server port: 443 cipher: AEAD_CHACHA20_POLY1305 password: \"password\" plugin: v2ray-plugin plugin-opts: mode: websocket # 暂时不支持 QUIC 协议 # tls: true # wss # skip-cert-verify: true # host: bing.com # path: \"/\" # headers: # custom: value # vmess # 支持加密方式：auto / aes-128-gcm / chacha20-poly1305 / none - name: \"vmess\" type: vmess server: server port: 443 uuid: uuid alterId: 32 cipher: auto # udp: true # tls: true # skip-cert-verify: true # servername: example.com # 优先级高于 wss host # network: ws # ws-path: /path # ws-headers: # Host: v2ray.com - name: \"vmess-http\" type: vmess server: server port: 443 uuid: uuid alterId: 32 cipher: auto # udp: true # network: http # http-opts: # # method: \"GET\" # # path: # # - '/' # # - '/video' # # headers: # # Connection: # # - keep-alive # socks5 - name: \"socks\" type: socks5 server: server port: 443 # username: username # password: password # tls: true # skip-cert-verify: true # udp: true # http - name: \"http\" type: http server: server port: 443 # username: username # password: password # tls: true # https # skip-cert-verify: true # snell (注意：暂时不支持 UDP 转发) - name: \"snell\" type: snell server: server port: 44046 psk: yourpsk # obfs-opts: # mode: http # 或 tls # host: bing.com # Trojan - name: \"trojan\" type: trojan server: server port: 443 password: yourpsk # udp: true # sni: example.com # 服务名称 # alpn: # - h2 # - http/1.1 # skip-cert-verify: true # ShadowsocksR # 支持的加密方式: SS 中支持的所有流加密方式 # 支持的混淆方式: # plain http_simple http_post # random_head tls1.2_ticket_auth tls1.2_ticket_fastauth # 支持的协议: # origin auth_sha1_v4 auth_aes128_md5 # auth_aes128_sha1 auth_chain_a auth_chain_b - name: \"ssr\" type: ssr server: server port: 443 cipher: chacha20-ietf password: \"password\" obfs: tls1.2_ticket_auth protocol: auth_sha1_v4 # obfs-param: domain.tld # protocol-param: \"#\" # udp: true proxy-groups: # 代理的转发链, 在 proxies 中不应该包含 relay. 不支持 UDP. # 流量: clash \u003c-\u003e http \u003c-\u003e vmess \u003c-\u003e ss1 \u003c-\u003e ss2 \u003c-\u003e 互联网 - name: \"relay\" type: relay proxies: - http - vmess - ss1 - ss2 # url-test 可以自动选择与指定 URL 测速后，延迟最短的服务器 - name: \"auto\" type: url-test proxies: - ss1 - ss2 - vmess1 url: 'http://www.gstatic.com/generate_204' interval: 300 # fallback 可以尽量按照用户书写的服务器顺序，在确保服务器可用的情况下，自动选择服务器 - name: \"fallback-auto\" type: fallback proxies: - ss1 - ss2 - vmess1 url: 'http://www.gstatic.com/generate_204' interval: 300 # load-balance 可以使相同 eTLD 请求在同一条代理线路上 - name: \"load-balance\" type: load-balance proxies: - ss1 - ss2 - vmess1 url: 'http://www.gstatic.com/generate_204' interval: 300 # select 用来允许用户手动选择 代理服务器 或 服务器组 # 您也可以使用 RESTful API 去切换服务器，这种方式推荐在 GUI 中使用 - name: Proxy type: select proxies: - ss1 - ss2 - vmess1 - auto - name: UseProvider type: select use: - provider1 proxies: - Proxy - DIRECT proxy-providers: provider1: type: http url: \"url\" interval: 3600 path: ./provider1.yaml health-check: enable: true interval: 600 url: http://www.gstatic.com/generate_204 test: type: file path: /test.yaml health-check: enable: true interval: 36000 url: http://www.gstatic.com/generate_204 rules: # 自定义规则 ## 您可以在此处插入您补充的自定义规则（请注意保持缩进） # DOMAIN-SUFFIX：域名后缀匹配 # DOMAIN：域名匹配 # DOMAIN-KEYWORD：域名关键字匹配 # IP-CIDR：IP段匹配 # SRC-IP-CIDR：源IP段匹配 # GEOIP：GEOIP数据库（国家代码）匹配 # DST-PORT：目标端口匹配 # SRC-PORT：源端口匹配 # PROCESS-NAME：源进程名匹配 # RULE-SET：Rule Provider规则匹配 # MATCH：全匹配 # 国内网站 - DOMAIN-SUFFIX,cn,DIRECT - DOMAIN-KEYWORD,-cn,DIRECT # 抗 DNS 污染 - DOMAIN-KEYWORD,amazon,Proxy # 常见广告域名屏蔽 - DOMAIN-KEYWORD,admarvel,REJECT # 国外网站 - DOMAIN-SUFFIX,9to5mac.com,Proxy - DOMAIN-SUFFIX,abpchina.org,Proxy # Telegram - DOMAIN-SUFFIX,telegra.ph,Proxy - DOMAIN-SUFFIX,telegram.org,Proxy - IP-CIDR,91.108.4.0/22,Proxy - IP-CIDR,91.108.8.0/21,Proxy - IP-CIDR,91.108.16.0/22,Proxy - IP-CIDR,91.108.56.0/22,Proxy - IP-CIDR,149.154.160.0/20,Proxy - IP-CIDR6,2001:67c:4e8::/48,Proxy - IP-CIDR6,2001:b28:f23d::/48,Proxy - IP-CIDR6,2001:b28:f23f::/48,Proxy # LAN - DOMAIN,injections.adguard.org,DIRECT - DOMAIN,local.adguard.org,DIRECT - DOMAIN-SUFFIX,local,DIRECT - IP-CIDR,127.0.0.0/8,DIRECT - IP-CIDR,172.16.0.0/12,DIRECT - IP-CIDR,192.168.0.0/16,DIRECT - IP-CIDR,10.0.0.0/8,DIRECT - IP-CIDR,17.0.0.0/8,DIRECT - IP-CIDR,100.64.0.0/10,DIRECT - IP-CIDR,224.0.0.0/4,DIRECT - IP-CIDR6,fe80::/10,DIRECT # 最终规则 - GEOIP,CN,DIRECT - MATCH,Proxy 5. Q\u0026A 问： 执行脚本返回 答： 脚本默认openWrt已安装tun，如果之前未安装，请执行 opkg update opkg install kmod-tun 全文完\n","wordCount":"4558","inLanguage":"zh","datePublished":"2023-01-19T15:28:05+08:00","dateModified":"2023-01-19T15:28:05+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://qing.shuncs.com/post/tech/clashinst/"},"publisher":{"@type":"Organization","name":"瞬间","logo":{"@type":"ImageObject","url":"https://qing.shuncs.com/favicon.ico"}}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://qing.shuncs.com/ accesskey=h title="Moment (Alt + H)"><img src=https://qing.shuncs.com/apple-touch-icon.png alt aria-label=logo height=35>Moment</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://qing.shuncs.com/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://qing.shuncs.com/archives title=归档><span>归档</span></a></li><li><a href=https://qing.shuncs.com/tags title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://qing.shuncs.com/>主页</a>&nbsp;»&nbsp;<a href=https://qing.shuncs.com/post/>Posts</a></div><h1 class=post-title>在openWrt上安装并配置Clash (Clash篇)</h1><div class=post-meta><span title='2023-01-19 15:28:05 +0800 CST'>2023-01-19</span>&nbsp;·&nbsp;10 分钟&nbsp;·&nbsp;4558 字<div class=meta-item>&nbsp·&nbsp
  <span id=busuanzi_container_page_pv>本文阅读量<span id=busuanzi_value_page_pv></span>次</span></div></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#安装环境>安装环境</a></li><li><a href=#目标>目标</a></li><li><a href=#0-下载>0. 下载</a></li><li><a href=#1-安装clash>1. 安装Clash</a></li><li><a href=#2-配置>2. 配置</a></li><li><a href=#3-软件下载>3. 软件下载</a></li><li><a href=#4-说明>4. 说明</a></li><li><a href=#5-qa>5. Q&A</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h3 id=安装环境>安装环境<a hidden class=anchor aria-hidden=true href=#安装环境>#</a></h3><p><strong>软路由机器架构: x86_64</strong><br><strong>OpenWrt版本: 22.03</strong><br><strong>Clash版本: Premium</strong><br><strong>OpenWrt的IP: 192.168.88.3 (如果不同,后面涉及此地址全部需要修改)</strong></p><h3 id=目标>目标<a hidden class=anchor aria-hidden=true href=#目标>#</a></h3><p>安装及配置完Clash后，在浏览器的设置->系统->打开您计算机的代理设置->手动设置代理
<img loading=lazy src=/img/clashinst/clash_inst_2.png alt>
按上图输入主路由器地址和端口，并保存退出就可以访问Google</p><hr><h3 id=0-下载>0. 下载<a hidden class=anchor aria-hidden=true href=#0-下载>#</a></h3><p><em><strong>以下软件需要预先下载，然后再通过Winscp工具上传到openWrt里面。</strong></em></p><ul><li>Clash</li><li>Country.mmdb</li><li>yacd (UI界面，可选)</li></ul><p><em><strong>也可以在openWrt命令行执行以下脚本自动安装及配置后续全部内容（但代理配置文件仍需自定义）</strong></em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wget https://www.shuncs.com/download/instclash.sh <span class=o>&amp;&amp;</span> chmod +x instclash.sh <span class=o>&amp;&amp;</span> ./instclash.sh
</span></span></code></pre></div><hr><h3 id=1-安装clash>1. 安装Clash<a hidden class=anchor aria-hidden=true href=#1-安装clash>#</a></h3><p>打开Winscp客户端，点击新建会话(快捷键ctrl+n)，文件协议选择SCP，主机名里面输入主路由器地址192.168.88.3，用户名输入root，如下图
<img loading=lazy src=/img/clashinst/clash_inst_1.png alt>
然后点击保存和确定，然后点击登录，将下载好的软件上传到openWrt中(如果有密钥提示，点击添加)</p><p>使用putty登录openWrt，然后按顺序执行以下命令（大小写勿输错）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /root
</span></span><span class=line><span class=cl>gunzip clash-linux-amd64-latest.gz
</span></span><span class=line><span class=cl>mv clash-linux-amd64-latest  /usr/bin/clash
</span></span><span class=line><span class=cl>chmod +x /usr/bin/clash
</span></span><span class=line><span class=cl>mkdir -p /root/.config/clash
</span></span><span class=line><span class=cl>mv Country.mmdb .config/clash/
</span></span></code></pre></div><hr><h3 id=2-配置>2. 配置<a hidden class=anchor aria-hidden=true href=#2-配置>#</a></h3><ul><li>新增Clash配置文件</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /root/.config/clash/router.yaml
</span></span></code></pre></div><p>将如下内容复制到文件中(以下部分内容自定义)，然后输入:wq保存退出</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>mixed-port</span><span class=p>:</span><span class=w> </span><span class=m>7890</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>redir-port</span><span class=p>:</span><span class=w> </span><span class=m>7892</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tproxy-port</span><span class=p>:</span><span class=w> </span><span class=m>7893</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>allow-lan</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>log-level</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ipv6</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#下面三行内容可以在web页面查看流量规则等,如果未安装请在前面加#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>secret</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>external-controller</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;192.168.88.3:9090&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>external-ui</span><span class=p>:</span><span class=w> </span><span class=l>ui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>store-fake-ip</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#如果未安装tun，请在前面加#注释掉</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tun</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stack</span><span class=p>:</span><span class=w> </span><span class=l>system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dns-hijack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tcp://8.8.8.8:53</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>udp://8.8.8.8:53</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>auto-route</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>auto-detect-interface</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ipv6</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>listen</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>5353</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enhanced-mode</span><span class=p>:</span><span class=w> </span><span class=l>fake-ip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fake-ip-range</span><span class=p>:</span><span class=w> </span><span class=m>198.18.0.1</span><span class=l>/16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>114.114.114.114</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fallback</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tls://dns.google:853</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tls://1.1.1.1:853</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fallback-filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>geoip</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>ipcidr</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=m>240.0.0.0</span><span class=l>/4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>proxy-providers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>proxyA</span><span class=p>:</span><span class=w>                         </span><span class=c>#根据实际情况自定义</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./proxies/proxyA.yaml  </span><span class=w> </span><span class=c>#根据实际情况自定义</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health-check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>36000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://www.gstatic.com/generate_204</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>proxyB</span><span class=p>:</span><span class=w>                         </span><span class=c>#根据实际情况自定义</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./proxies/proxyB.yaml  </span><span class=w> </span><span class=c>#根据实际情况自定义</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health-check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>36000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://www.gstatic.com/generate_204</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>proxyURL</span><span class=p>:</span><span class=w>                      </span><span class=c>#如果是订阅链接在此处配置即可</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>url</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://raw.githubusercontent.com/learnhard-cn/free_proxy_ss/main/clash/clash.provider.yaml&#34;</span><span class=w> </span><span class=c>#根据实际情况自定义</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>3600</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./proxies/proxyURL.yaml</span><span class=w> </span><span class=c>#根据实际情况自定义</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health-check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>600</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://www.gstatic.com/generate_204</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>proxy-groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;auto&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>url-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>use</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyA   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyB   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;http://www.gstatic.com/generate_204&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Proxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>use</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyB   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># fallback 自动选择服务器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;fallback-auto&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>fallback</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>use</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyA   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyB   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;http://www.gstatic.com/generate_204&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;load-balance&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>load-balance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>use</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyA   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxyB   </span><span class=w> </span><span class=c>#需要和上面名称对应</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;http://www.gstatic.com/generate_204&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rule-providers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>reject</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>behavior</span><span class=p>:</span><span class=w> </span><span class=l>classical</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./rules/reject.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>proxy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>behavior</span><span class=p>:</span><span class=w> </span><span class=l>classical</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./rules/proxy.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 拒绝-&gt;代理-&gt;其余直连</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,reject,REJECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,proxy,fallback-auto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,DIRECT</span><span class=w>
</span></span></span></code></pre></div><ul><li><strong>新增规则文件</strong></li></ul><p>输入以下命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /root/.config/clash/rules/proxy.yaml
</span></span></code></pre></div><p>将如下内容复制到文件中，然后输入:wq保存退出</p><pre tabindex=0><code>payload:
  - DOMAIN-KEYWORD,amazon
  - DOMAIN-KEYWORD,google
  - DOMAIN-KEYWORD,gmail
  - DOMAIN-KEYWORD,youtube
  - DOMAIN-KEYWORD,facebook
  - DOMAIN-SUFFIX,fb.me
  - DOMAIN-SUFFIX,fbcdn.net
  - DOMAIN-KEYWORD,twitter
  - DOMAIN-KEYWORD,instagram
  - DOMAIN-KEYWORD,dropbox
  - DOMAIN-SUFFIX,twimg.com
  - DOMAIN-KEYWORD,blogspot
  - DOMAIN-SUFFIX,youtu.be
  - DOMAIN-KEYWORD,whatsapp
  - DOMAIN-SUFFIX,9to5mac.com
  - DOMAIN-SUFFIX,abpchina.org
  - DOMAIN-SUFFIX,adblockplus.org
  - DOMAIN-SUFFIX,adobe.com
  - DOMAIN-SUFFIX,akamaized.net
  - DOMAIN-SUFFIX,alfredapp.com
  - DOMAIN-SUFFIX,amplitude.com
  - DOMAIN-SUFFIX,ampproject.org
  - DOMAIN-SUFFIX,android.com
  - DOMAIN-SUFFIX,angularjs.org
  - DOMAIN-SUFFIX,aolcdn.com
  - DOMAIN-SUFFIX,apkpure.com
  - DOMAIN-SUFFIX,appledaily.com
  - DOMAIN-SUFFIX,appshopper.com
  - DOMAIN-SUFFIX,appspot.com
  - DOMAIN-SUFFIX,arcgis.com
  - DOMAIN-SUFFIX,archive.org
  - DOMAIN-SUFFIX,armorgames.com
  - DOMAIN-SUFFIX,aspnetcdn.com
  - DOMAIN-SUFFIX,att.com
  - DOMAIN-SUFFIX,awsstatic.com
  - DOMAIN-SUFFIX,azureedge.net
  - DOMAIN-SUFFIX,azurewebsites.net
  - DOMAIN-SUFFIX,bing.com
  - DOMAIN-SUFFIX,bintray.com
  - DOMAIN-SUFFIX,bit.com
  - DOMAIN-SUFFIX,bit.ly
  - DOMAIN-SUFFIX,bitbucket.org
  - DOMAIN-SUFFIX,bjango.com
  - DOMAIN-SUFFIX,bkrtx.com
  - DOMAIN-SUFFIX,blog.com
  - DOMAIN-SUFFIX,blogcdn.com
  - DOMAIN-SUFFIX,blogger.com
  - DOMAIN-SUFFIX,blogsmithmedia.com
  - DOMAIN-SUFFIX,blogspot.com
  - DOMAIN-SUFFIX,blogspot.hk
  - DOMAIN-SUFFIX,bloomberg.com
  - DOMAIN-SUFFIX,box.com
  - DOMAIN-SUFFIX,box.net
  - DOMAIN-SUFFIX,cachefly.net
  - DOMAIN-SUFFIX,chromium.org
  - DOMAIN-SUFFIX,cl.ly
  - DOMAIN-SUFFIX,cloudflare.com
  - DOMAIN-SUFFIX,cloudfront.net
  - DOMAIN-SUFFIX,cloudmagic.com
  - DOMAIN-SUFFIX,cmail19.com
  - DOMAIN-SUFFIX,cnet.com
  - DOMAIN-SUFFIX,cocoapods.org
  - DOMAIN-SUFFIX,comodoca.com
  - DOMAIN-SUFFIX,crashlytics.com
  - DOMAIN-SUFFIX,culturedcode.com
  - DOMAIN-SUFFIX,d.pr
  - DOMAIN-SUFFIX,danilo.to
  - DOMAIN-SUFFIX,dayone.me
  - DOMAIN-SUFFIX,db.tt
  - DOMAIN-SUFFIX,deskconnect.com
  - DOMAIN-SUFFIX,disq.us
  - DOMAIN-SUFFIX,disqus.com
  - DOMAIN-SUFFIX,disquscdn.com
  - DOMAIN-SUFFIX,dnsimple.com
  - DOMAIN-SUFFIX,docker.com
  - DOMAIN-SUFFIX,dribbble.com
  - DOMAIN-SUFFIX,droplr.com
  - DOMAIN-SUFFIX,duckduckgo.com
  - DOMAIN-SUFFIX,dueapp.com
  - DOMAIN-SUFFIX,dytt8.net
  - DOMAIN-SUFFIX,edgecastcdn.net
  - DOMAIN-SUFFIX,edgekey.net
  - DOMAIN-SUFFIX,edgesuite.net
  - DOMAIN-SUFFIX,engadget.com
  - DOMAIN-SUFFIX,entrust.net
  - DOMAIN-SUFFIX,eurekavpt.com
  - DOMAIN-SUFFIX,evernote.com
  - DOMAIN-SUFFIX,fabric.io
  - DOMAIN-SUFFIX,fast.com
  - DOMAIN-SUFFIX,fastly.net
  - DOMAIN-SUFFIX,fc2.com
  - DOMAIN-SUFFIX,feedburner.com
  - DOMAIN-SUFFIX,feedly.com
  - DOMAIN-SUFFIX,feedsportal.com
  - DOMAIN-SUFFIX,fiftythree.com
  - DOMAIN-SUFFIX,firebaseio.com
  - DOMAIN-SUFFIX,flexibits.com
  - DOMAIN-SUFFIX,flickr.com
  - DOMAIN-SUFFIX,flipboard.com
  - DOMAIN-SUFFIX,g.co
  - DOMAIN-SUFFIX,gabia.net
  - DOMAIN-SUFFIX,geni.us
  - DOMAIN-SUFFIX,gfx.ms
  - DOMAIN-SUFFIX,ggpht.com
  - DOMAIN-SUFFIX,ghostnoteapp.com
  - DOMAIN-SUFFIX,git.io
  - DOMAIN-KEYWORD,github
  - DOMAIN-SUFFIX,globalsign.com
  - DOMAIN-SUFFIX,gmodules.com
  - DOMAIN-SUFFIX,godaddy.com
  - DOMAIN-SUFFIX,golang.org
  - DOMAIN-SUFFIX,gongm.in
  - DOMAIN-SUFFIX,goo.gl
  - DOMAIN-SUFFIX,goodreaders.com
  - DOMAIN-SUFFIX,goodreads.com
  - DOMAIN-SUFFIX,gravatar.com
  - DOMAIN-SUFFIX,gstatic.com
  - DOMAIN-SUFFIX,gvt0.com
  - DOMAIN-SUFFIX,hockeyapp.net
  - DOMAIN-SUFFIX,hotmail.com
  - DOMAIN-SUFFIX,icons8.com
  - DOMAIN-SUFFIX,ifixit.com
  - DOMAIN-SUFFIX,ift.tt
  - DOMAIN-SUFFIX,ifttt.com
  - DOMAIN-SUFFIX,iherb.com
  - DOMAIN-SUFFIX,imageshack.us
  - DOMAIN-SUFFIX,img.ly
  - DOMAIN-SUFFIX,imgur.com
  - DOMAIN-SUFFIX,imore.com
  - DOMAIN-SUFFIX,instapaper.com
  - DOMAIN-SUFFIX,ipn.li
  - DOMAIN-SUFFIX,is.gd
  - DOMAIN-SUFFIX,issuu.com
  - DOMAIN-SUFFIX,itgonglun.com
  - DOMAIN-SUFFIX,itun.es
  - DOMAIN-SUFFIX,ixquick.com
  - DOMAIN-SUFFIX,j.mp
  - DOMAIN-SUFFIX,js.revsci.net
  - DOMAIN-SUFFIX,jshint.com
  - DOMAIN-SUFFIX,jtvnw.net
  - DOMAIN-SUFFIX,justgetflux.com
  - DOMAIN-SUFFIX,kat.cr
  - DOMAIN-SUFFIX,klip.me
  - DOMAIN-SUFFIX,libsyn.com
  - DOMAIN-SUFFIX,linkedin.com
  - DOMAIN-SUFFIX,linode.com
  - DOMAIN-SUFFIX,lithium.com
  - DOMAIN-SUFFIX,littlehj.com
  - DOMAIN-SUFFIX,live.com
  - DOMAIN-SUFFIX,live.net
  - DOMAIN-SUFFIX,livefilestore.com
  - DOMAIN-SUFFIX,llnwd.net
  - DOMAIN-SUFFIX,macid.co
  - DOMAIN-SUFFIX,macromedia.com
  - DOMAIN-SUFFIX,macrumors.com
  - DOMAIN-SUFFIX,mashable.com
  - DOMAIN-SUFFIX,mathjax.org
  - DOMAIN-SUFFIX,medium.com
  - DOMAIN-SUFFIX,mega.co.nz
  - DOMAIN-SUFFIX,mega.nz
  - DOMAIN-SUFFIX,megaupload.com
  - DOMAIN-SUFFIX,microsofttranslator.com
  - DOMAIN-SUFFIX,mindnode.com
  - DOMAIN-SUFFIX,mobile01.com
  - DOMAIN-SUFFIX,modmyi.com
  - DOMAIN-SUFFIX,msedge.net
  - DOMAIN-SUFFIX,myfontastic.com
  - DOMAIN-SUFFIX,name.com
  - DOMAIN-SUFFIX,nextmedia.com
  - DOMAIN-SUFFIX,nsstatic.net
  - DOMAIN-SUFFIX,nssurge.com
  - DOMAIN-SUFFIX,nyt.com
  - DOMAIN-SUFFIX,nytimes.com
  - DOMAIN-SUFFIX,omnigroup.com
  - DOMAIN-SUFFIX,onedrive.com
  - DOMAIN-SUFFIX,onenote.com
  - DOMAIN-SUFFIX,ooyala.com
  - DOMAIN-SUFFIX,openvpn.net
  - DOMAIN-SUFFIX,openwrt.org
  - DOMAIN-SUFFIX,orkut.com
  - DOMAIN-SUFFIX,osxdaily.com
  - DOMAIN-SUFFIX,outlook.com
  - DOMAIN-SUFFIX,ow.ly
  - DOMAIN-SUFFIX,paddleapi.com
  - DOMAIN-SUFFIX,parallels.com
  - DOMAIN-SUFFIX,parse.com
  - DOMAIN-SUFFIX,pdfexpert.com
  - DOMAIN-SUFFIX,periscope.tv
  - DOMAIN-SUFFIX,pinboard.in
  - DOMAIN-SUFFIX,pinterest.com
  - DOMAIN-SUFFIX,pixelmator.com
  - DOMAIN-SUFFIX,pixiv.net
  - DOMAIN-SUFFIX,playpcesor.com
  - DOMAIN-SUFFIX,playstation.com
  - DOMAIN-SUFFIX,playstation.com.hk
  - DOMAIN-SUFFIX,playstation.net
  - DOMAIN-SUFFIX,playstationnetwork.com
  - DOMAIN-SUFFIX,pushwoosh.com
  - DOMAIN-SUFFIX,rime.im
  - DOMAIN-SUFFIX,servebom.com
  - DOMAIN-SUFFIX,sfx.ms
  - DOMAIN-SUFFIX,shadowsocks.org
  - DOMAIN-SUFFIX,sharethis.com
  - DOMAIN-SUFFIX,shazam.com
  - DOMAIN-SUFFIX,skype.com
  - DOMAIN-SUFFIX,smartdnsProxy.com
  - DOMAIN-SUFFIX,smartmailcloud.com
  - DOMAIN-SUFFIX,sndcdn.com
  - DOMAIN-SUFFIX,sony.com
  - DOMAIN-SUFFIX,soundcloud.com
  - DOMAIN-SUFFIX,sourceforge.net
  - DOMAIN-SUFFIX,spotify.com
  - DOMAIN-SUFFIX,squarespace.com
  - DOMAIN-SUFFIX,sstatic.net
  - DOMAIN-SUFFIX,st.luluku.pw
  - DOMAIN-SUFFIX,stackoverflow.com
  - DOMAIN-SUFFIX,startpage.com
  - DOMAIN-SUFFIX,staticflickr.com
  - DOMAIN-SUFFIX,steamcommunity.com
  - DOMAIN-SUFFIX,symauth.com
  - DOMAIN-SUFFIX,symcb.com
  - DOMAIN-SUFFIX,symcd.com
  - DOMAIN-SUFFIX,tapbots.com
  - DOMAIN-SUFFIX,tapbots.net
  - DOMAIN-SUFFIX,tdesktop.com
  - DOMAIN-SUFFIX,techcrunch.com
  - DOMAIN-SUFFIX,techsmith.com
  - DOMAIN-SUFFIX,thepiratebay.org
  - DOMAIN-SUFFIX,theverge.com
  - DOMAIN-SUFFIX,time.com
  - DOMAIN-SUFFIX,timeinc.net
  - DOMAIN-SUFFIX,tiny.cc
  - DOMAIN-SUFFIX,tinypic.com
  - DOMAIN-SUFFIX,tmblr.co
  - DOMAIN-SUFFIX,todoist.com
  - DOMAIN-SUFFIX,trello.com
  - DOMAIN-SUFFIX,trustasiassl.com
  - DOMAIN-SUFFIX,tumblr.co
  - DOMAIN-SUFFIX,tumblr.com
  - DOMAIN-SUFFIX,tweetdeck.com
  - DOMAIN-SUFFIX,tweetmarker.net
  - DOMAIN-SUFFIX,twitch.tv
  - DOMAIN-SUFFIX,txmblr.com
  - DOMAIN-SUFFIX,typekit.net
  - DOMAIN-SUFFIX,ubertags.com
  - DOMAIN-SUFFIX,ublock.org
  - DOMAIN-SUFFIX,ubnt.com
  - DOMAIN-SUFFIX,ulyssesapp.com
  - DOMAIN-SUFFIX,urchin.com
  - DOMAIN-SUFFIX,usertrust.com
  - DOMAIN-SUFFIX,v.gd
  - DOMAIN-SUFFIX,v2ex.com
  - DOMAIN-SUFFIX,vimeo.com
  - DOMAIN-SUFFIX,vimeocdn.com
  - DOMAIN-SUFFIX,vine.co
  - DOMAIN-SUFFIX,vivaldi.com
  - DOMAIN-SUFFIX,vox-cdn.com
  - DOMAIN-SUFFIX,vsco.co
  - DOMAIN-SUFFIX,vultr.com
  - DOMAIN-SUFFIX,w.org
  - DOMAIN-SUFFIX,w3schools.com
  - DOMAIN-SUFFIX,webtype.com
  - DOMAIN-SUFFIX,wikiwand.com
  - DOMAIN-SUFFIX,wikileaks.org
  - DOMAIN-SUFFIX,wikimedia.org
  - DOMAIN-SUFFIX,wikipedia.com
  - DOMAIN-SUFFIX,wikipedia.org
  - DOMAIN-SUFFIX,windows.com
  - DOMAIN-SUFFIX,windows.net
  - DOMAIN-SUFFIX,wire.com
  - DOMAIN-SUFFIX,wordpress.com
  - DOMAIN-SUFFIX,workflowy.com
  - DOMAIN-SUFFIX,wp.com
  - DOMAIN-SUFFIX,wsj.com
  - DOMAIN-SUFFIX,wsj.net
  - DOMAIN-SUFFIX,xda-developers.com
  - DOMAIN-SUFFIX,xeeno.com
  - DOMAIN-SUFFIX,xiti.com
  - DOMAIN-SUFFIX,yahoo.com
  - DOMAIN-SUFFIX,yimg.com
  - DOMAIN-SUFFIX,ying.com
  - DOMAIN-SUFFIX,yoyo.org
  - DOMAIN-SUFFIX,ytimg.com
</code></pre><ul><li><strong>新增黑名单文件</strong></li></ul><p>输入以下命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /root/.config/clash/rules/reject.yaml
</span></span></code></pre></div><p>将如下内容复制到文件中，然后输入:wq保存退出</p><pre tabindex=0><code>payload:
  - DOMAIN-KEYWORD,admarvel
  - DOMAIN-KEYWORD,admaster
  - DOMAIN-KEYWORD,adsage
  - DOMAIN-KEYWORD,adsmogo
  - DOMAIN-KEYWORD,adsrvmedia
  - DOMAIN-KEYWORD,adwords
  - DOMAIN-KEYWORD,adservice
  - DOMAIN-SUFFIX,appsflyer.com
  - DOMAIN-KEYWORD,domob
  - DOMAIN-SUFFIX,doubleclick.net
  - DOMAIN-KEYWORD,duomeng
  - DOMAIN-KEYWORD,dwtrack
  - DOMAIN-KEYWORD,guanggao
  - DOMAIN-KEYWORD,lianmeng
  - DOMAIN-SUFFIX,mmstat.com
  - DOMAIN-KEYWORD,mopub
  - DOMAIN-KEYWORD,omgmta
  - DOMAIN-KEYWORD,openx
  - DOMAIN-KEYWORD,partnerad
  - DOMAIN-KEYWORD,pingfore
  - DOMAIN-KEYWORD,supersonicads
  - DOMAIN-KEYWORD,uedas
  - DOMAIN-KEYWORD,umeng
  - DOMAIN-KEYWORD,usage
  - DOMAIN-SUFFIX,vungle.com
  - DOMAIN-KEYWORD,wlmonitor
  - DOMAIN-KEYWORD,zjtoolbar
</code></pre><ul><li><strong>测试Clash配置文件的格式是否正确</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>clash -d /root/.config/clash/ -t -f router.yaml
</span></span></code></pre></div><ul><li><strong>设置openWrt中每次开机自动启动Clash</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /etc/init.d/clash
</span></span></code></pre></div><p>将此内容复制到文件中,并输入:wq保存退出。</p><pre tabindex=0><code>#!/bin/sh /etc/rc.common

START=90
STOP=15

USE_PROCD=1
#PROCD_DEBUG=1

CONF=/root/.config/clash/
CONFFILE=router.yaml
PROG=/usr/bin/clash

start_service() {
        procd_open_instance
        procd_set_param command $PROG -f $CONF$CONFFILE -d $CONF
        procd_set_param stdout 1
        procd_set_param stderr 1
        procd_set_param respawn ${respawn_threshold:-3600} ${respawn_timeout:-5} ${respawn_retry:-9}
        procd_close_instance
}
</code></pre><ul><li><strong>设置权限，并使之生效</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>chmod <span class=m>755</span> /etc/init.d/clash
</span></span><span class=line><span class=cl>service clash <span class=nb>enable</span>
</span></span></code></pre></div><ul><li><strong>启动Clash</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>service clash start
</span></span></code></pre></div><ul><li><strong>配置Clash UI (可选)</strong><br>使用Winscp工具，将yacd.tar内的<strong>文件夹</strong>上传到openWrt机器，然后执行以下命令</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mv /root/public /root/.config/clash/ui
</span></span><span class=line><span class=cl>/etc/init.d/clash restart
</span></span></code></pre></div><p>在浏览器地址栏中输入: <a href=http://192.168.88.3:9090/ui>http://192.168.88.3:9090/ui</a> 显示以下内容，在Host一栏输入192.168.88.3，点击确定即可显示Clash详细页面
<img loading=lazy src=/img/clashinst/clash_inst_3.png alt></p><hr><h3 id=3-软件下载>3. 软件下载<a hidden class=anchor aria-hidden=true href=#3-软件下载>#</a></h3><table><thead><tr><th>名称</th><th>版本号</th><th>说明</th><th>下载地址</th></tr></thead><tbody><tr><td>Clash</td><td>Premium</td><td>透明代理</td><td><a href=https://release.dreamacro.workers.dev/latest/clash-linux-amd64-latest.gz>https://release.dreamacro.workers.dev/latest/clash-linux-amd64-latest.gz</a></td></tr><tr><td>Clash-dashboard</td><td></td><td>clash Web界面</td><td><a href=https://github.com/Dreamacro/clash-dashboard/archive/refs/heads/gh-pages.zip>https://github.com/Dreamacro/clash-dashboard/archive/refs/heads/gh-pages.zip</a></td></tr><tr><td>Winscp</td><td>5.21</td><td>SCP客户端</td><td><a href=https://winscp.net/download/WinSCP-5.21.5-Portable.zip>https://winscp.net/download/WinSCP-5.21.5-Portable.zip</a></td></tr><tr><td>Putty</td><td>0.78</td><td>虚拟终端</td><td><a href=https://the.earth.li/~sgtatham/putty/latest/w64/putty.exe>https://the.earth.li/~sgtatham/putty/latest/w64/putty.exe</a></td></tr><tr><td>Country.mmdb</td><td></td><td>IP地址库</td><td><a href=https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb>https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb</a></td></tr></tbody></table><hr><h3 id=4-说明>4. 说明<a hidden class=anchor aria-hidden=true href=#4-说明>#</a></h3><ul><li><strong>Clash版本区别</strong></li></ul><blockquote><p>Premium 版本支持TUN和配置文件中RULE-SET<br>如果有电视机顶盒,只能使用Premium版本</p></blockquote><ul><li><strong>Clash规则配置文件格式(Premium有效)</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>payload</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN-SUFFIX,yinxiang.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN-SUFFIX,fb.me</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN-KEYWORD,linkedin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,local.adguard.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>IP-CIDR,192.168.0.0/16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>PROCESS-NAME,wechat</span><span class=w>
</span></span></span></code></pre></div><ul><li><p><strong>Clash配置说明</strong></p><table><thead><tr><th>规则</th><th>说明</th><th>范例</th><th>说明</th></tr></thead><tbody><tr><td>PROCESS-NAME</td><td>匹配进程</td><td>wechat.exe</td><td>进程名包含该关键字,在透明代理上不生效</td></tr><tr><td>PROCESS-SUFFIX</td><td>域名后缀</td><td>yinxiang.com</td><td></td></tr><tr><td>PROCESS-KEYWORD</td><td>域名关键字</td><td>linkedin</td><td></td></tr><tr><td>DOMAIN</td><td>域名匹配</td><td>local.adguard.org</td><td></td></tr><tr><td>IP-CIDR</td><td>IP段匹配</td><td>192.168.0.0/16</td><td></td></tr><tr><td>SRC-IP-CIDR</td><td>源IP段匹配</td><td>192.168.0.0/16</td><td></td></tr><tr><td>GEOIP</td><td>GEOIP数据库匹配</td><td>CN</td><td>国家代码</td></tr><tr><td>DST-PORT</td><td>目标端口匹配</td><td></td><td></td></tr><tr><td>SRC-PORT</td><td>源端口匹配</td><td></td><td></td></tr><tr><td>MATCH</td><td>全匹配</td><td></td><td>一般放在最后</td></tr></tbody></table></li><li><p><strong>Clash的配置文件详细说明</strong></p></li></ul><p><em><strong>此配置文件既可以用在普通版本也可以用在Preumium版本</strong></em></p><pre tabindex=0><code># HTTP 代理端口
port: 7890

# SOCKS5 代理端口
socks-port: 7891

# Linux 和 macOS 的 redir 透明代理端口 (重定向 TCP 和 TProxy UDP 流量)
# redir-port: 7892

# Linux 的透明代理端口（适用于 TProxy TCP 和 TProxy UDP 流量)
# tproxy-port: 7893

# HTTP(S) and SOCKS5 共用端口
# mixed-port: 7890

# 本地 SOCKS5/HTTP(S) 服务验证
# authentication:
#  - &#34;user1:pass1&#34;
#  - &#34;user2:pass2&#34;

# 允许局域网的连接（可用来共享代理）
allow-lan: true
bind-address: &#34;*&#34;
# 此功能仅在 allow-lan 设置为 true 时生效，支持三种参数：
# &#34;*&#34;                           绑定所有的 IP 地址
# 192.168.122.11                绑定一个的 IPv4 地址
# &#34;[aaaa::a8aa:ff:fe09:57d8]&#34;   绑定一个 IPv6 地址

# Clash 路由工作模式
# 规则模式：rule（规则） / global（全局代理）/ direct（全局直连）
mode: rule

# Clash 默认将日志输出至 STDOUT
# 设置日志输出级别 (默认级别：silent，即不输出任何内容，以避免因日志内容过大而导致程序内存溢出）。
# 5 个级别：silent / info / warning / error / debug。级别越高日志输出量越大，越倾向于调试，若需要请自行开启。
log-level: silent

# clash 的 RESTful API 监听地址
external-controller: 127.0.0.1:9090

# 存放配置文件的相对路径，或存放网页静态资源的绝对路径
# Clash core 将会将其部署在 http://{{external-controller}}/ui
# external-ui: folder

# RESTful API 的口令 (可选)
# 通过 HTTP 头中 Authorization: Bearer ${secret} 参数来验证口令
# 当 RESTful API 的监听地址为 0.0.0.0 时，请务必设定口令以保证安全
# secret: &#34;&#34;

# 出站网卡接口
# interface-name: en0

# DNS 服务器和建立连接时的 静态 Hosts, 仅在 dns.enhanced-mode 模式为 redir-host 生效
# 支持通配符域名 (例如: *.clash.dev, *.foo.*.example.com )
# 不使用通配符的域名优先级高于使用通配符的域名 (例如: foo.example.com &gt; *.example.com &gt; .example.com )
# 注意: +.foo.com 的效果等同于 .foo.com 和 foo.com
hosts:
# &#39;*.clash.dev&#39;: 127.0.0.1
# &#39;.dev&#39;: 127.0.0.1
# &#39;alpha.clash.dev&#39;: &#39;::1&#39;

# DNS 服务器配置(可选；若不配置，程序内置的 DNS 服务会被关闭)
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: true # 当此选项为 false 时, AAAA 请求将返回空

  # 以下填写的 DNS 服务器将会被用来解析 DNS 服务的域名
  # 仅填写 DNS 服务器的 IP 地址
  default-nameserver:
    - 223.5.5.5
    - 114.114.114.114
  enhanced-mode: fake-ip # 或 redir-host
  fake-ip-range: 198.18.0.1/16 # Fake IP 地址池 (CIDR 形式)
  # use-hosts: true # 查询 hosts 并返回 IP 记录

  # 在以下列表的域名将不会被解析为 fake ip，这些域名相关的解析请求将会返回它们真实的 IP 地址
  fake-ip-filter:
    # 以下域名列表参考自 vernesong/OpenClash 项目，并由 Hackl0us 整理补充
    # === LAN ===
    - &#39;*.lan&#39;
    # === Linksys Wireless Router ===
    - &#39;*.linksys.com&#39;
    - &#39;*.linksyssmartwifi.com&#39;
    # === Apple Software Update Service ===
    - &#39;swscan.apple.com&#39;
    - &#39;mesu.apple.com&#39;
    # === Windows 10 Connnect Detection ===
    - &#39;*.msftconnecttest.com&#39;
    - &#39;*.msftncsi.com&#39;
    # === NTP Service ===
    - &#39;time.*.com&#39;
    - &#39;time.*.gov&#39;
    - &#39;time.*.edu.cn&#39;
    - &#39;time.*.apple.com&#39;

    - &#39;time1.*.com&#39;
    - &#39;time2.*.com&#39;
    - &#39;time3.*.com&#39;
    - &#39;time4.*.com&#39;
    - &#39;time5.*.com&#39;
    - &#39;time6.*.com&#39;
    - &#39;time7.*.com&#39;

    - &#39;ntp.*.com&#39;
    - &#39;ntp.*.com&#39;
    - &#39;ntp1.*.com&#39;
    - &#39;ntp2.*.com&#39;
    - &#39;ntp3.*.com&#39;
    - &#39;ntp4.*.com&#39;
    - &#39;ntp5.*.com&#39;
    - &#39;ntp6.*.com&#39;
    - &#39;ntp7.*.com&#39;

    - &#39;*.time.edu.cn&#39;
    - &#39;*.ntp.org.cn&#39;
    - &#39;+.pool.ntp.org&#39;

    - &#39;time1.cloud.tencent.com&#39;
    # === Music Service ===
    ## NetEase
    - &#39;+.music.163.com&#39;
    - &#39;*.126.net&#39;
    ## Baidu
    - &#39;musicapi.taihe.com&#39;
    - &#39;music.taihe.com&#39;
    ## Kugou
    - &#39;songsearch.kugou.com&#39;
    - &#39;trackercdn.kugou.com&#39;
    ## Kuwo
    - &#39;*.kuwo.cn&#39;
    ## JOOX
    - &#39;api-jooxtt.sanook.com&#39;
    - &#39;api.joox.com&#39;
    - &#39;joox.com&#39;
    ## QQ
    - &#39;+.y.qq.com&#39;
    - &#39;+.music.tc.qq.com&#39;
    - &#39;aqqmusic.tc.qq.com&#39;
    - &#39;+.stream.qqmusic.qq.com&#39;
    ## Xiami
    - &#39;*.xiami.com&#39;
    ## Migu
    - &#39;+.music.migu.cn&#39;
    # === Game Service ===
    ## Nintendo Switch
    - &#39;+.srv.nintendo.net&#39;
    ## Sony PlayStation
    - &#39;+.stun.playstation.net&#39;
    ## Microsoft Xbox
    - &#39;xbox.*.microsoft.com&#39;
    - &#39;+.xboxlive.com&#39;
    # === Other ===
    ## QQ Quick Login
    - &#39;localhost.ptlogin2.qq.com&#39;
    ## Golang
    - &#39;proxy.golang.org&#39;
    ## STUN Server
    - &#39;stun.*.*&#39;
    - &#39;stun.*.*.*&#39;


    ## Bilibili CDN
    - &#39;*.mcdn.bilivideo.cn&#39;

  # 支持 UDP / TCP / DoT / DoH 协议的 DNS 服务，可以指明具体的连接端口号。
  # 所有 DNS 请求将会直接发送到服务器，不经过任何代理。
  # Clash 会使用最先获得的解析记录回复 DNS 请求
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query

  # 当 fallback 参数被配置时, DNS 请求将同时发送至上方 nameserver 列表和下方 fallback 列表中配置的所有 DNS 服务器.
  # 当解析得到的 IP 地址的地理位置不是 CN 时，clash 将会选用 fallback 中 DNS 服务器的解析结果。
  # fallback:
  #   - https://dns.google/dns-query

  # 如果使用 nameserver 列表中的服务器解析的 IP 地址在下方列表中的子网中，则它们被认为是无效的，
  # Clash 会选用 fallback 列表中配置 DNS 服务器解析得到的结果。
  #
  # 当 fallback-filter.geoip 为 true 且 IP 地址的地理位置为 CN 时，
  # Clash 会选用 nameserver 列表中配置 DNS 服务器解析得到的结果。
  #
  # 当 fallback-filter.geoip 为 false, 如果解析结果不在 fallback-filter.ipcidr 范围内，
  # Clash 总会选用 nameserver 列表中配置 DNS 服务器解析得到的结果。
  #
  # 采取以上逻辑进行域名解析是为了对抗 DNS 投毒攻击。
  fallback-filter:
    geoip: false
    ipcidr:
      - 240.0.0.0/4
      - 0.0.0.0/32
    # domain:
    #   - &#39;+.google.com&#39;
    #   - &#39;+.facebook.com&#39;
    #   - &#39;+.youtube.com&#39;

proxies:
  # shadowsocks
  # 支持加密方式：
  #   aes-128-gcm aes-192-gcm aes-256-gcm
  #   aes-128-cfb aes-192-cfb aes-256-cfb
  #   aes-128-ctr aes-192-ctr aes-256-ctr
  #   rc4-md5 chacha20 chacha20-ietf xchacha20
  #   chacha20-ietf-poly1305 xchacha20-ietf-poly1305

  - name: &#34;ss1&#34;
    type: ss
    server: server
    port: 443
    cipher: chacha20-ietf-poly1305
    password: &#34;password&#34;
    # udp: true

  - name: &#34;ss2&#34;
    type: ss
    server: server
    port: 443
    cipher: AEAD_CHACHA20_POLY1305
    password: &#34;password&#34;
    plugin: obfs
    plugin-opts:
      mode: tls # 混淆模式，可以选择 http 或 tls
      host: bing.com # 混淆域名，需要和服务器配置保持一致

  - name: &#34;ss3&#34;
    type: ss
    server: server
    port: 443
    cipher: AEAD_CHACHA20_POLY1305
    password: &#34;password&#34;
    plugin: v2ray-plugin
    plugin-opts:
      mode: websocket # 暂时不支持 QUIC 协议
      # tls: true # wss
      # skip-cert-verify: true
      # host: bing.com
      # path: &#34;/&#34;
      # headers:
      #   custom: value

  # vmess
  # 支持加密方式：auto / aes-128-gcm / chacha20-poly1305 / none
  - name: &#34;vmess&#34;
    type: vmess
    server: server
    port: 443
    uuid: uuid
    alterId: 32
    cipher: auto
    # udp: true
    # tls: true
    # skip-cert-verify: true
    # servername: example.com # 优先级高于 wss host
    # network: ws
    # ws-path: /path
    # ws-headers:
    #   Host: v2ray.com

  - name: &#34;vmess-http&#34;
    type: vmess
    server: server
    port: 443
    uuid: uuid
    alterId: 32
    cipher: auto
    # udp: true
    # network: http
    # http-opts:
    #   # method: &#34;GET&#34;
    #   # path:
    #   #   - &#39;/&#39;
    #   #   - &#39;/video&#39;
    #   # headers:
    #   #   Connection:
    #   #     - keep-alive

  # socks5
  - name: &#34;socks&#34;
    type: socks5
    server: server
    port: 443
    # username: username
    # password: password
    # tls: true
    # skip-cert-verify: true
    # udp: true

  # http
  - name: &#34;http&#34;
    type: http
    server: server
    port: 443
    # username: username
    # password: password
    # tls: true # https
    # skip-cert-verify: true

  # snell (注意：暂时不支持 UDP 转发)
  - name: &#34;snell&#34;
    type: snell
    server: server
    port: 44046
    psk: yourpsk
    # obfs-opts:
    # mode: http # 或 tls
    # host: bing.com

  # Trojan
  - name: &#34;trojan&#34;
    type: trojan
    server: server
    port: 443
    password: yourpsk
    # udp: true
    # sni: example.com # 服务名称
    # alpn:
    #   - h2
    #   - http/1.1
    # skip-cert-verify: true

  # ShadowsocksR
  # 支持的加密方式: SS 中支持的所有流加密方式
  # 支持的混淆方式:
  #   plain http_simple http_post
  #   random_head tls1.2_ticket_auth tls1.2_ticket_fastauth
  # 支持的协议:
  #   origin auth_sha1_v4 auth_aes128_md5
  #   auth_aes128_sha1 auth_chain_a auth_chain_b
  - name: &#34;ssr&#34;
    type: ssr
    server: server
    port: 443
    cipher: chacha20-ietf
    password: &#34;password&#34;
    obfs: tls1.2_ticket_auth
    protocol: auth_sha1_v4
    # obfs-param: domain.tld
    # protocol-param: &#34;#&#34;
    # udp: true

proxy-groups:
  # 代理的转发链, 在 proxies 中不应该包含 relay. 不支持 UDP.
  # 流量: clash &lt;-&gt; http &lt;-&gt; vmess &lt;-&gt; ss1 &lt;-&gt; ss2 &lt;-&gt; 互联网
  - name: &#34;relay&#34;
    type: relay
    proxies:
      - http
      - vmess
      - ss1
      - ss2

  # url-test 可以自动选择与指定 URL 测速后，延迟最短的服务器
  - name: &#34;auto&#34;
    type: url-test
    proxies:
      - ss1
      - ss2
      - vmess1
    url: &#39;http://www.gstatic.com/generate_204&#39;
    interval: 300

  # fallback 可以尽量按照用户书写的服务器顺序，在确保服务器可用的情况下，自动选择服务器
  - name: &#34;fallback-auto&#34;
    type: fallback
    proxies:
      - ss1
      - ss2
      - vmess1
    url: &#39;http://www.gstatic.com/generate_204&#39;
    interval: 300

  # load-balance 可以使相同 eTLD 请求在同一条代理线路上
  - name: &#34;load-balance&#34;
    type: load-balance
    proxies:
      - ss1
      - ss2
      - vmess1
    url: &#39;http://www.gstatic.com/generate_204&#39;
    interval: 300

  # select 用来允许用户手动选择 代理服务器 或 服务器组
  # 您也可以使用 RESTful API 去切换服务器，这种方式推荐在 GUI 中使用
  - name: Proxy
    type: select
    proxies:
      - ss1
      - ss2
      - vmess1
      - auto

  - name: UseProvider
    type: select
    use:
      - provider1
    proxies:
      - Proxy
      - DIRECT

proxy-providers:
  provider1:
    type: http
    url: &#34;url&#34;
    interval: 3600
    path: ./provider1.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
  test:
    type: file
    path: /test.yaml
    health-check:
      enable: true
      interval: 36000
      url: http://www.gstatic.com/generate_204

rules:
  # 自定义规则
  ## 您可以在此处插入您补充的自定义规则（请注意保持缩进）
  # DOMAIN-SUFFIX：域名后缀匹配
  # DOMAIN：域名匹配
  # DOMAIN-KEYWORD：域名关键字匹配
  # IP-CIDR：IP段匹配
  # SRC-IP-CIDR：源IP段匹配
  # GEOIP：GEOIP数据库（国家代码）匹配
  # DST-PORT：目标端口匹配
  # SRC-PORT：源端口匹配
  # PROCESS-NAME：源进程名匹配
  # RULE-SET：Rule Provider规则匹配
  # MATCH：全匹配

  # 国内网站
  - DOMAIN-SUFFIX,cn,DIRECT
  - DOMAIN-KEYWORD,-cn,DIRECT

  # 抗 DNS 污染
  - DOMAIN-KEYWORD,amazon,Proxy

  # 常见广告域名屏蔽
  - DOMAIN-KEYWORD,admarvel,REJECT

  # 国外网站
  - DOMAIN-SUFFIX,9to5mac.com,Proxy
  - DOMAIN-SUFFIX,abpchina.org,Proxy

  # Telegram
  - DOMAIN-SUFFIX,telegra.ph,Proxy
  - DOMAIN-SUFFIX,telegram.org,Proxy
  - IP-CIDR,91.108.4.0/22,Proxy
  - IP-CIDR,91.108.8.0/21,Proxy
  - IP-CIDR,91.108.16.0/22,Proxy
  - IP-CIDR,91.108.56.0/22,Proxy
  - IP-CIDR,149.154.160.0/20,Proxy
  - IP-CIDR6,2001:67c:4e8::/48,Proxy
  - IP-CIDR6,2001:b28:f23d::/48,Proxy
  - IP-CIDR6,2001:b28:f23f::/48,Proxy

  # LAN
  - DOMAIN,injections.adguard.org,DIRECT
  - DOMAIN,local.adguard.org,DIRECT
  - DOMAIN-SUFFIX,local,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,17.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT
  - IP-CIDR6,fe80::/10,DIRECT

  # 最终规则
  - GEOIP,CN,DIRECT
  - MATCH,Proxy
</code></pre><h3 id=5-qa>5. Q&A<a hidden class=anchor aria-hidden=true href=#5-qa>#</a></h3><ul><li><strong>问：</strong> 执行脚本返回</li><li><strong>答：</strong> 脚本默认openWrt已安装tun，如果之前未安装，请执行</li></ul><pre tabindex=0><code>opkg update
opkg install kmod-tun
</code></pre><p><strong>全文完</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://qing.shuncs.com/tags/openwrt/>openWrt</a></li><li><a href=https://qing.shuncs.com/tags/clash/>clash</a></li><li><a href=https://qing.shuncs.com/tags/2023/>2023</a></li></ul><nav class=paginav><a class=prev href=https://qing.shuncs.com/post/tech/nft4clash/><span class=title>« 上一页</span><br><span>在openWrt上安装并配置Clash (Nftable篇)</span></a>
<a class=next href=https://qing.shuncs.com/post/tech/openwrt_inst/><span class=title>下一页 »</span><br><span>在openWrt上安装并配置Clash (openWrt篇)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://qing.shuncs.com/>瞬间</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量<span id=busuanzi_value_site_pv></span>次</span>
<span id=busuanzi_container_site_uv>本站访客数<span id=busuanzi_value_site_uv></span>人次</span></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>